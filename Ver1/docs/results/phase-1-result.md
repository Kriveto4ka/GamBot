# Результаты этапа 1: Базовый бот

## Статус: выполнен

## Критерии готовности (из phase-1.md)

| Критерий | Статус |
|----------|--------|
| /start создаёт персонажа при первом запуске (level=1, xp=0, hp=100, max_hp=100) | ✅ |
| Повторный /start показывает главное меню с актуальными уровнем и HP | ✅ |
| Главное меню отображается с inline-кнопками: Новая задача, Мои задачи, Персонаж, Статистика | ✅ |
| Кнопка «Персонаж» открывает экран персонажа (уровень, XP, HP, прогресс-бары) | ✅ |
| С экрана персонажа кнопка «Меню» возвращает в главное меню | ✅ |
| Данные пользователя сохраняются между перезапусками бота (PostgreSQL) | ✅ |
| Токен бота задаётся через переменные окружения | ✅ |

## Реализованные компоненты

### Код

- **config.py** — BOT_TOKEN, DATABASE_URL из env; константы персонажа (SPEC 2.1); формула `xp_required_for_level(level)` (SPEC 2.2).
- **database/models.py** — модель User (SPEC 7.1): telegram_id, username, level, xp, hp, max_hp, total_completed, total_failed, max_level_reached, created_at.
- **database/engine.py** — async engine (asyncpg), session factory, `init_db()`.
- **database/user_repo.py** — `get_or_create_user(session, telegram_id, username)` → (User, is_new).
- **bot/texts.py** — тексты: приветствие (8.1), главное меню (8.2), экран персонажа (8.3) с прогресс-барами, заглушка «Скоро».
- **bot/keyboards.py** — клавиатуры: приветствие (одна кнопка), главное меню (R13), «Меню» для возврата (R19).
- **bot/handlers/start.py** — команда /start: создание/получение пользователя, приветствие для новых, главное меню для вернувшихся.
- **bot/handlers/menu.py** — callback `menu` → главное меню; `screen:character` → экран персонажа (R17); `task:new`, `task:list`, `screen:stats` → заглушка с кнопкой «Меню».
- **main.py** — инициализация БД, регистрация роутеров, polling. BOT_TOKEN проверяется при запуске.

### Инфраструктура

- **docker-compose.yml** — сервисы `db` (PostgreSQL 16) и `bot`; переменные BOT_TOKEN, DATABASE_URL.
- **Dockerfile** — Python 3.12, установка зависимостей, запуск `main.py`.
- **.env.example** — пример BOT_TOKEN и DATABASE_URL.
- **requirements.txt** — aiogram, sqlalchemy, asyncpg, python-dotenv, pytest.

### Тесты

- **tests/test_character.py** — формула XP (100*N), начальные статы персонажа (1, 0, 100, 100). Все 5 тестов проходят.

## Как запустить

1. Скопировать `.env.example` в `.env`, указать `BOT_TOKEN`.
2. Локально (нужен запущенный PostgreSQL на localhost:5432 или свой DATABASE_URL):
   ```bash
   pip install -r requirements.txt
   python main.py
   ```
3. Через Docker:
   ```bash
   docker compose up --build
   ```
   В `.env` задать `BOT_TOKEN`.

## Проверка

- Отправить боту /start — для нового пользователя: приветствие и кнопка «Создать первую задачу» (ведёт в меню).
- Повторный /start или кнопка «Меню» — главное меню с уровнем 1 и HP 100/100, кнопки Новая задача, Мои задачи (0), Персонаж, Статистика.
- Кнопка «Персонаж» — экран с уровнем, XP 0/100, HP 100/100, прогресс-барами, «Активных задач: 0», «Ближайший дедлайн: —», кнопка «Меню».
- Кнопки «Новая задача», «Мои задачи», «Статистика» — сообщение «Скоро будет доступно» и кнопка «Меню».

## Ссылки на спецификацию

- R6, R12, R13, R17, R19 — реализованы.
- Экраны 8.1, 8.2, 8.3 — реализованы.
- Сценарий 1 (первый запуск) — реализован.
- NR4 (данные не теряются), NR7 (токен в env), NR8–NR9 (Docker, PostgreSQL) — учтены.
