# Project DNA: GameTODO Bot

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –≤–æ—Å—Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–±–æ—á–µ–π —Å–∏—Å—Ç–µ–º—ã –¥—Ä—É–≥–æ–π –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é. –î–æ–∫—É–º–µ–Ω—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥–∞, —Ç–æ–ª—å–∫–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞.

---

## 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

**GameTODO Bot** ‚Äî Telegram-–±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ —Å –∏–≥—Ä–æ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∫–æ–π (–≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è).

### –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è
–ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ —Ä—É—Ç–∏–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –≤ –∏–≥—Ä—É —á–µ—Ä–µ–∑:
- –ù–∞–≥—Ä–∞–¥—ã –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (XP, —É—Ä–æ–≤–Ω–∏)
- –ù–∞–∫–∞–∑–∞–Ω–∏—è –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É (—É—Ä–æ–Ω HP)
- –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞ "—Å–º–µ—Ä—Ç–∏" –∏ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–æ—Ç–∏–≤–∞—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á.

---

## 2. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|-----------|------------|-------------|
| –Ø–∑—ã–∫ | Python 3.12+ | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π async/await |
| Bot Framework | aiogram 3.x | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å, FSM, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API |
| Database | PostgreSQL 16 | –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ACID |
| ORM | SQLAlchemy 2.0 | Async support, type hints |
| Scheduler | APScheduler | –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å asyncio |
| Timezone | zoneinfo | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Python 3.9+ |
| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è | Docker + Docker Compose | –ò–∑–æ–ª—è—Ü–∏—è, –ø—Ä–æ—Å—Ç–æ—Ç–∞ –¥–µ–ø–ª–æ—è |

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 3.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ scheduler
‚îú‚îÄ‚îÄ config.py                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, —Ñ–æ—Ä–º—É–ª—ã
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/              # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram –∫–æ–º–∞–Ω–¥ –∏ callback
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py           # /start, —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ menu.py            # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é, —ç–∫—Ä–∞–Ω –ø–µ—Ä—Å–æ–Ω–∞–∂–∞, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task_create.py     # FSM —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ task_list.py       # –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á, –¥–µ—Ç–∞–ª–∏, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ keyboards.py           # Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ texts.py               # –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ time_utils.py          # –†–∞–±–æ—Ç–∞ —Å –≤—Ä–µ–º–µ–Ω–µ–º, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ deadline_parser.py     # –ü–∞—Ä—Å–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –¥–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ safe_edit.py           # –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ logic/
‚îÇ       ‚îú‚îÄ‚îÄ game.py            # –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ (XP, —É—Ä–æ–Ω, —É—Ä–æ–≤–Ω–∏)
‚îÇ       ‚îú‚îÄ‚îÄ tasks.py           # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ notifications.py   # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 1 —á–∞—Å
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ models.py              # SQLAlchemy –º–æ–¥–µ–ª–∏ (User, Task)
‚îÇ   ‚îú‚îÄ‚îÄ engine.py              # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î, async session
‚îÇ   ‚îú‚îÄ‚îÄ user_repo.py           # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ task_repo.py           # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ tests/                     # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ docker-compose.yml         # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile                 # Docker –æ–±—Ä–∞–∑
‚îî‚îÄ‚îÄ requirements.txt           # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### 3.2 –°–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

| –°–ª–æ–π | –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|------|--------------|-----------------|
| Presentation | `bot/handlers/` | –ü—Ä–∏—ë–º –∫–æ–º–∞–Ω–¥, –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ |
| Business Logic | `bot/logic/` | –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤ |
| Data Access | `database/` | CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏, –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö |

### 3.3 –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

1. Telegram Update –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ handler
2. Handler –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ repository
3. Handler –≤—ã–∑—ã–≤–∞–µ—Ç business logic (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
4. Handler —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ texts.py –∏ keyboards.py
5. Handler –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## 4. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### 4.1 –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (User)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | Integer | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| telegram_id | BigInteger | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram (unique) |
| username | String(255) | Username –≤ Telegram (nullable) |
| level | Integer | –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å (default: 1) |
| xp | Integer | –¢–µ–∫—É—â–∏–π –æ–ø—ã—Ç (default: 0) |
| hp | Integer | –¢–µ–∫—É—â–µ–µ –∑–¥–æ—Ä–æ–≤—å–µ (default: 100) |
| max_hp | Integer | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ (default: 100) |
| total_completed | Integer | –í—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á (default: 0) |
| total_failed | Integer | –í—Å–µ–≥–æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –∑–∞–¥–∞—á (default: 0) |
| max_level_reached | Integer | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å (default: 1) |
| created_at | DateTime | –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |

**–í–∞–∂–Ω–æ:** –ú–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å relationship –∫ Task –¥–ª—è –∂–∞–¥–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.

### 4.2 –ó–∞–¥–∞—á–∞ (Task)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | Integer | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á |
| user_id | Integer | –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ User |
| title | String(200) | –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ |
| difficulty | Enum | –°–ª–æ–∂–Ω–æ—Å—Ç—å: easy, medium, hard, epic |
| deadline | DateTime | –î–µ–¥–ª–∞–π–Ω (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ UTC, –±–µ–∑ timezone) |
| status | Enum | –°—Ç–∞—Ç—É—Å: active, completed, failed, deleted |
| created_at | DateTime | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| completed_at | DateTime | –î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (nullable) |
| reminder_sent | Integer | –§–ª–∞–≥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (0/1) |

**–í–∞–∂–Ω–æ:** –ú–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å relationship –∫ User –¥–ª—è selectinload.

### 4.3 Enum –∑–Ω–∞—á–µ–Ω–∏—è

**TaskDifficulty:** easy, medium, hard, epic

**TaskStatus:** active, completed, failed, deleted

---

## 5. –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞

### 5.1 –ù–∞—á–∞–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| Level | 1 |
| XP | 0 |
| HP | 100 |
| Max HP | 100 |

### 5.2 –§–æ—Ä–º—É–ª—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –§–æ—Ä–º—É–ª–∞ |
|----------|---------|
| XP –¥–ª—è —É—Ä–æ–≤–Ω—è N | 100 √ó N |
| HP –ø—Ä–∏ level-up | max_hp += 10 |
| HP –ø—Ä–∏ level-up | hp = max_hp (–ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ) |

### 5.3 –°–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á

| –°–ª–æ–∂–Ω–æ—Å—Ç—å | XP (–Ω–∞–≥—Ä–∞–¥–∞) | –£—Ä–æ–Ω (—à—Ç—Ä–∞—Ñ) |
|-----------|--------------|--------------|
| easy | 10 | 5 |
| medium | 25 | 15 |
| hard | 50 | 30 |
| epic | 100 | 50 |

### 5.4 –ü—Ä–∞–≤–∏–ª–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è XP

1. XP –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏ –≤–æ–≤—Ä–µ–º—è
2. –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ XP ‚Üí level-up, XP —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 0
3. –ò–∑–ª–∏—à–µ–∫ XP –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
4. –í–æ–∑–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ level-up –∑–∞ –æ–¥–Ω—É –∑–∞–¥–∞—á—É

### 5.5 –ü—Ä–∞–≤–∏–ª–∞ –Ω–∞–Ω–µ—Å–µ–Ω–∏—è —É—Ä–æ–Ω–∞

1. –£—Ä–æ–Ω –Ω–∞–Ω–æ—Å–∏—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ—Å—Ä–æ—á–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤ ‚Äî –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
3. –ü—Ä–∏ HP ‚â§ 0 ‚Äî —Å–º–µ—Ä—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

### 5.6 –°–º–µ—Ä—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

–ü—Ä–∏ HP ‚â§ 0:
1. –°–±—Ä–æ—Å level ‚Üí 1
2. –°–±—Ä–æ—Å xp ‚Üí 0
3. –°–±—Ä–æ—Å hp ‚Üí 100
4. –°–±—Ä–æ—Å max_hp ‚Üí 100
5. –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á (soft delete, —Å—Ç–∞—Ç—É—Å deleted)
6. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ total_failed
7. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ—Ä—Ç–∏

---

## 6. –†–∞–±–æ—Ç–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º

### 6.1 –ü—Ä–∏–Ω—Ü–∏–ø—ã

1. **–•—Ä–∞–Ω–µ–Ω–∏–µ:** –í—Å–µ –¥–µ–¥–ª–∞–π–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ UTC –∫–∞–∫ `TIMESTAMP WITHOUT TIME ZONE` (naive datetime)
2. **–í–≤–æ–¥:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –ø–∞—Ä—Å–∏—Ç—Å—è –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è (UTC+3), –∑–∞—Ç–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ UTC
3. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:** –í—Ä–µ–º—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ UTC –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### 6.2 –ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞

- INPUT_TIMEZONE = "Europe/Moscow" (UTC+3)
- UTC_TIMEZONE = "UTC"

### 6.3 –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞

**–ü—Ä–∞–≤–∏–ª–æ 1:** –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ë–î ‚Äî —É–¥–∞–ª–∏—Ç—å tzinfo (—Å–¥–µ–ª–∞—Ç—å naive UTC)

**–ü—Ä–∞–≤–∏–ª–æ 2:** –ü—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å deadline –∏–∑ –ë–î ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `datetime.utcnow()` (naive)

**–ü—Ä–∞–≤–∏–ª–æ 3:** –ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å tzinfo=UTC, –∑–∞—Ç–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Moscow

**–ü—Ä–∞–≤–∏–ª–æ 4:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–º–µ—à–∏–≤–∞—Ç—å naive –∏ aware datetime –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è—Ö

### 6.4 –§–æ—Ä–º–∞—Ç—ã –≤–≤–æ–¥–∞ –¥–µ–¥–ª–∞–π–Ω–∞

- "–∑–∞–≤—Ç—Ä–∞ 18:00"
- "25.01 15:30"
- "25.01.2025 15:30"
- "—á–µ—Ä–µ–∑ 2 —á–∞—Å–∞"
- "—á–µ—Ä–µ–∑ 1 –¥–µ–Ω—å" / "—á–µ—Ä–µ–∑ 2 –¥–Ω—è" / "—á–µ—Ä–µ–∑ 5 –¥–Ω–µ–π"

---

## 7. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–æ—Ç–∞

### 7.1 –ù–∞–≤–∏–≥–∞—Ü–∏—è

- –í—Å—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ ‚Äî /start
- –ö–∞–∂–¥—ã–π —ç–∫—Ä–∞–Ω –∏–º–µ–µ—Ç –∫–Ω–æ–ø–∫—É –≤–æ–∑–≤—Ä–∞—Ç–∞

### 7.2 –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

–ö–Ω–æ–ø–∫–∏:
- ‚ûï –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞
- üìã –ú–æ–∏ –∑–∞–¥–∞—á–∏ (—Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º)
- üë§ –ü–µ—Ä—Å–æ–Ω–∞–∂
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### 7.3 FSM —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
1. title ‚Äî –≤–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è
2. difficulty ‚Äî –≤—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
3. deadline ‚Äî –≤—ã–±–æ—Ä/–≤–≤–æ–¥ –¥–µ–¥–ª–∞–π–Ω–∞

**–ü–µ—Ä–µ—Ö–æ–¥—ã:**
- /start ‚Üí title ‚Üí difficulty ‚Üí deadline ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ
- –û—Ç–º–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–∞ –Ω–∞ –ª—é–±–æ–º —à–∞–≥–µ

### 7.4 –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä –¥–µ–¥–ª–∞–π–Ω–∞

–ö–Ω–æ–ø–∫–∏:
- –ß–µ—Ä–µ–∑ 1 —á–∞—Å
- –ß–µ—Ä–µ–∑ 3 —á–∞—Å–∞
- –°–µ–≥–æ–¥–Ω—è 21:00
- –ó–∞–≤—Ç—Ä–∞ 10:00
- –ó–∞–≤—Ç—Ä–∞ 18:00
- –í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é

---

## 8. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 8.1 –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 1 —á–∞—Å

- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è, –µ—Å–ª–∏ –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞ < 1 —á–∞—Å–∞
- –§–ª–∞–≥ reminder_sent –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –°–æ–¥–µ—Ä–∂–∏—Ç inline-–∫–Ω–æ–ø–∫–∏ "–í—ã–ø–æ–ª–Ω–µ–Ω–æ" –∏ "–û—Ç–∫—Ä—ã—Ç—å"

### 8.2 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Å—Ä–æ—á–∫–µ

- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ—Å—Ä–æ—á–∫–∏
- –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—É—á–µ–Ω–Ω–æ–º —É—Ä–æ–Ω–µ
- –°–æ–¥–µ—Ä–∂–∏—Ç inline-–∫–Ω–æ–ø–∫–∏ "–ö –∑–∞–¥–∞—á–∞–º" –∏ "–ú–µ–Ω—é"

### 8.3 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ level-up

- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
- –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ –∏ HP
- –°–æ–¥–µ—Ä–∂–∏—Ç inline-–∫–Ω–æ–ø–∫—É "–ú–µ–Ω—é"

### 8.4 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–º–µ—Ä—Ç–∏

- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ HP ‚â§ 0
- –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–±—Ä–æ—Å–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –°–æ–¥–µ—Ä–∂–∏—Ç inline-–∫–Ω–æ–ø–∫–∏ "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞" –∏ "–ú–µ–Ω—é"

---

## 9. Scheduler

### 9.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤

- –ò–Ω—Ç–µ—Ä–≤–∞–ª: –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –î–µ–π—Å—Ç–≤–∏—è:
  1. –ù–∞–π—Ç–∏ –≤—Å–µ –∑–∞–¥–∞—á–∏ —Å deadline <= now –∏ status = active
  2. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏:
     - –ù–∞–Ω–µ—Å—Ç–∏ —É—Ä–æ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
     - –ü–æ–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –∫–∞–∫ failed
     - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  3. –ü—Ä–∏ —Å–º–µ—Ä—Ç–∏ ‚Äî —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 9.2 –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

- –ò–Ω—Ç–µ—Ä–≤–∞–ª: –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –î–µ–π—Å—Ç–≤–∏—è:
  1. –ù–∞–π—Ç–∏ –∑–∞–¥–∞—á–∏ —Å deadline –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 1 —á–∞—Å–∞
  2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
  3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å reminder_sent = 1

---

## 10. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã

### 10.1 –°–º–µ—à–∏–≤–∞–Ω–∏–µ naive –∏ aware datetime

**–ü—Ä–æ–±–ª–µ–º–∞:** `TypeError: can't compare offset-naive and offset-aware datetimes`

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ë–î ‚Äî —É–¥–∞–ª–∏—Ç—å tzinfo
- –ü—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ ‚Äî –æ–±–∞ datetime –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å naive –∏–ª–∏ –æ–±–∞ aware
- –ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å tzinfo=UTC, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å

### 10.2 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ relationship –≤ –º–æ–¥–µ–ª–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** `AttributeError: type object 'Task' has no attribute 'user'`

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å relationship –≤ –º–æ–¥–µ–ª—å Task –¥–ª—è –∂–∞–¥–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 10.3 HTTP-–∑–∞–ø—Ä–æ—Å—ã –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–æ–ª–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
1. –í —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî —Ç–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î
2. –ü–æ—Å–ª–µ commit ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 10.4 "Message is not modified"

**–ü—Ä–æ–±–ª–µ–º–∞:** Telegram API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:** –û–±–µ—Ä–Ω—É—Ç—å edit_text –≤ try-except, –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É "message is not modified"

---

## 11. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------------|----------|
| BOT_TOKEN | –î–∞ | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –æ—Ç @BotFather |
| DATABASE_URL | –ù–µ—Ç | URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL (default –¥–ª—è Docker) |

---

## 12. Docker Compose

### –°–µ—Ä–≤–∏—Å—ã

1. **db** ‚Äî PostgreSQL 16
   - –û–±—ä—ë–º –¥–ª—è –¥–∞–Ω–Ω—ã—Ö: postgres_data
   - Healthcheck: pg_isready
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB

2. **bot** ‚Äî Python 3.12-slim
   - –ó–∞–≤–∏—Å–∏—Ç –æ—Ç db (condition: service_healthy)
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: BOT_TOKEN, DATABASE_URL
   - Restart: unless-stopped

---

## 13. –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤—ã–π –±–æ—Ç
- –ö–æ–º–∞–Ω–¥–∞ /start —Å–æ–∑–¥–∞—ë—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å inline-–∫–Ω–æ–ø–∫–∞–º–∏
- –≠–∫—Ä–∞–Ω –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (—Å—Ç–∞—Ç—É—Å)

### –≠—Ç–∞–ø 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏
- –ö–Ω–æ–ø–∫–∞ "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞" ‚Üí –ø–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å
- –ö–Ω–æ–ø–∫–∞ "–ú–æ–∏ –∑–∞–¥–∞—á–∏" ‚Üí —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–∫–∞–º–∏
- –î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞—á–∏ ‚Üí –∫–Ω–æ–ø–∫–∏ "–í—ã–ø–æ–ª–Ω–µ–Ω–æ" / "–£–¥–∞–ª–∏—Ç—å"

### –≠—Ç–∞–ø 3: –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞
- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤ (scheduler)
- –ù–∞–Ω–µ—Å–µ–Ω–∏–µ —É—Ä–æ–Ω–∞ –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É

### –≠—Ç–∞–ø 4: –°–º–µ—Ä—Ç—å –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ú–µ—Ö–∞–Ω–∏–∫–∞ —Å–º–µ—Ä—Ç–∏ –∏ —Å–±—Ä–æ—Å–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ —á–∞—Å –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ—Å—Ä–æ—á–∫–µ/—Å–º–µ—Ä—Ç–∏/—É—Ä–æ–≤–Ω–µ

### –≠—Ç–∞–ø 5: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ polish
- –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö edge cases

---

## 14. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

1. /start —Å–æ–∑–¥–∞—ë—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
2. –í—Å—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏
3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ ‚Äî –ø–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å –∫–Ω–æ–ø–∫–∞–º–∏
4. –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞–º–∏, –∫–ª–∏–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏
5. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á —Ä–∞–±–æ—Ç–∞–µ—Ç
6. XP –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è, —É—Ä–æ–≤–Ω–∏ –ø–æ–≤—ã—à–∞—é—Ç—Å—è
7. –£—Ä–æ–Ω –Ω–∞–Ω–æ—Å–∏—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ—Å—Ä–æ—á–∫–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
8. –°–º–µ—Ä—Ç—å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ 0 HP, –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
9. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è (–∑–∞ —á–∞—Å, –ø—Ä–æ—Å—Ä–æ—á–∫–∞, —É—Ä–æ–≤–µ–Ω—å, —Å–º–µ—Ä—Ç—å)
10. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
11. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ docker-compose up

---

## 15. –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **SPEC.md** ‚Äî –ø–æ–ª–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Å —ç–∫—Ä–∞–Ω–∞–º–∏ –∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
- **decisions.md** ‚Äî –ø—Ä–∏–Ω—è—Ç—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- **issues.md** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –±–∞–≥–æ–≤
- **antipatterns.md** ‚Äî —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è
