# Решения и уточнения

Документ фиксирует принятые решения по вопросам, не расписанным однозначно в SPEC.md.

---

## 1. Часовой пояс

**Вопрос:** В какой timezone считаются дедлайны и проверка просрочки?

**Решение:** Использовать **локальный часовой пояс пользователя**.

- Дедлайны хранятся и интерпретируются в контексте времени пользователя.
- При реализации нужно либо хранить timezone пользователя (например, в профиле User), либо запрашивать при первом использовании относительных формулировок («сегодня вечером», «завтра 18:00»).

---

## 2. Быстрый выбор дедлайна

**Вопрос:** Кнопки «Сегодня вечером», «Завтра утром» — как трактовать?

**Решение:** Использовать **точные формулировки** (конкретное время).

- «Сегодня вечером» → фиксированное время (например, 21:00 по локальному времени пользователя).
- «Завтра утром» → фиксированное время (например, 10:00).
- Аналогично для остальных быстрых кнопок: в коде и в текстах кнопок использовать явные значения (например, «Сегодня 21:00», «Завтра 10:00»), а не размытые формулировки.

---

## 3. Множественная просрочка (E9)

**Вопрос:** Несколько задач просрочены одновременно — порядок начисления урона и проверки смерти.

**Решение:** **Сначала суммировать весь урон по всем просроченным задачам, затем один раз применить суммарный урон и после этого проверить смерть.**

- Не применять урон по одной задаче с промежуточной проверкой смерти.
- Алгоритм: собрать все просроченные задачи пользователя → вычислить суммарный урон → вычесть из HP → если HP ≤ 0 — выполнить механику смерти (сброс уровня/XP/HP, удаление активных задач, уведомление).

---

## 4. Масштабирование (NR3)

**Вопрос:** Нужны ли нагрузочные тесты на 100+ пользователей?

**Решение:** **Достаточно проектирования под один процесс бота.**

- Явные нагрузочные тесты не требуются.
- Архитектура и реализация ориентируются на один инстанс бота и одну БД.
