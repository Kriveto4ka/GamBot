# Архитектура GameTODO Bot

## Общая схема
Система состоит из одного приложения-бота и базы данных PostgreSQL. Бот принимает входящие события через фреймворк aiogram, управляет состоянием пользователя и задач, формирует ответы и уведомления. Фоновые проверки дедлайнов выполняются с регулярным интервалом внутри бота.

## Модули и ответственность

### 1) Модуль входящих событий
Отвечает за:
- обработку команды первого запуска
- обработку нажатий inline-кнопок
- обработку текстового ввода при создании задач

Границы:
- принимает события и передаёт их в модуль сценариев
- не содержит бизнес-логики наград, урона и уровней

### 2) Модуль сценариев и экранов
Отвечает за:
- состояние диалогов при создании задачи
- навигацию между экранами меню
- формирование текстов экранов и кнопок

Границы:
- использует сервисный слой для бизнес-операций
- не обращается напрямую к базе данных

### 3) Сервисный слой задач
Отвечает за:
- создание, удаление, завершение задач
- получение активных и просроченных задач
- валидации названия и дедлайна

Границы:
- не управляет уровнем и здоровьем пользователя
- работает с хранилищем через слой доступа к данным

### 4) Сервисный слой персонажа
Отвечает за:
- начисление опыта и повышение уровня
- расчёт урона и обработку смерти
- обновление статистики пользователя

Границы:
- не формирует тексты сообщений
- не управляет логикой экранов

### 5) Модуль планировщика
Отвечает за:
- регулярную проверку дедлайнов
- отправку уведомлений о просрочке и напоминаний

Границы:
- использует сервисы задач и персонажа
- не вмешивается в активные диалоги пользователя

### 6) Слой доступа к данным
Отвечает за:
- чтение и запись пользователей и задач
- транзакционную целостность операций

Границы:
- не содержит бизнес-логики

## Поток данных
1. Пользователь инициирует действие через команду или кнопку.
2. Модуль входящих событий передаёт управление сценариям.
3. Сценарии вызывают сервисы задач и персонажа.
4. Сервисы записывают изменения через слой доступа к данным.
5. Сценарии формируют ответ и возвращают его пользователю.

## Нефункциональные ограничения
- Ответы пользователю не более 2 секунд.
- Система должна выдерживать 100+ активных пользователей.
- Токен бота хранится только в переменных окружения.
